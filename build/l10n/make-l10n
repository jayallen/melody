#! /bin/bash
# 
# to make XX.pm, 
#  $ cd /PATH/TO/MT_ROOT_DIR
#  $ tools/l10n/make-l10n XX
# you can get XX in $TEMP_DIR


TEMP_DIR=/tmp
SCRIPT_DIR=build/l10n

if [ -n $1 ]; then
    TARGET=$1
fi

if [ -z $TARGET ]; then
    TARGET=ja
fi

find *.cgi alt-tmpl default_templates lib mt-static php plugins search_templates tmpl -type f -name "*.cgi" -or -name "*.pm" -or -name "*.pl" -or -name "*.tmpl" -or -name "*.php" -or -name "*.pre" -or -name "*.js" | \
awk -v target=$TARGET -v dir=$SCRIPT_DIR '{print "perl", dir "/trans.pl -t lib/MT/L10N/" target ".pm", $1 }' | bash > $TEMP_DIR/$TARGET-base.pm
perl $SCRIPT_DIR/diff.pl -old lib/MT/L10N/$TARGET.pm -new $TEMP_DIR/$TARGET-base.pm > $TEMP_DIR/$TARGET-old.pm
cat $TEMP_DIR/$TARGET-old.pm >> $TEMP_DIR/$TARGET-base.pm
cat $TEMP_DIR/$TARGET-base.pm | perl $SCRIPT_DIR/wrap.pl $TARGET > $TEMP_DIR/$TARGET.pm
perl -Ilib -cw $TEMP_DIR/$TARGET.pm
rm -f $TEMP_DIR/$TARGET-*.pm
