<mt:if name="object_type" eq="page">
    <mt:if name="can_manage_pages">
        <mt:setvar name="can_publish_post" value="1">
    </mt:if>
    <mt:setvar name="disp_prefs_show_category" value="1">
    <mt:setvar name="container_label" value="<__trans phrase="Folder">">
    <mt:setvar name="basename_label" value="<__trans phrase="Filename">">
    <mt:setvar name="container_label_plural" value="<__trans phrase="Folders">">
    <mt:setvar name="container_type" value="Folder">
<mt:else>
    <mt:setvar name="container_label" value="<__trans phrase="Category">">
    <mt:setvar name="basename_label" value="<__trans phrase="Basename">">
    <mt:setvar name="container_label_plural" value="<__trans phrase="Categories">">
    <mt:setvar name="container_type" value="Category">
    <mt:ignore>
        <__trans phrase="folder">
        <__trans phrase="folders">
        <__trans phrase="category">
        <__trans phrase="categories">
    </mt:ignore>
</mt:if>
<mt:if name="new_object">
    <mt:setvarblock name="page_title"><__trans phrase="Create [_1]" params="<$mt:var name="object_label"$>"></mt:setvarblock>
<mt:else>
    <mt:setvarblock name="page_title"><__trans phrase="Edit [_1]"  params="<$mt:var name="object_label"$>"></mt:setvarblock>
</mt:if>
<mt:setvarblock name="content_header">
    <div id="msg-block">

    <mt:unless name="recovered_object">
        <mt:if name="autosaved_object_exists">
            <mtapp:statusmsg
                id="recovered-object"
                class="info">
                <__trans phrase="A saved version of this [_1] was auto-saved [_3]. <a href="[_2]">Recover auto-saved content</a>" params="<mt:var name="object_label">%%<mt:var name="script_url">?__mode=view&amp;_type=<mt:var name="object_type">&amp;_recover=1<mt:if name="id">&amp;id=<mt:var name="id"></mt:if><mt:if name="blog_id">&amp;blog_id=<mt:var name="blog_id"></mt:if>%%<mt:date ts="$autosaved_object_ts" relative="1">">
            </mtapp:statusmsg>
        </mt:if>
    </mt:unless>

    <mt:if name="saved_added">
        <mtapp:statusmsg
            id="saved-added"
            class="success">
            <__trans phrase="Your [_1] has been saved. You can now make any changes to the [_1] itself, edit the authored-on date, or edit comments." params="<$mt:var name="object_label" lower_case="1"$>">
        </mtapp:statusmsg>
    </mt:if>

    <mt:if name="saved_changes">
        <mtapp:statusmsg
            id="saved-changes"
            class="success">
            <__trans phrase="Your changes have been saved.">
        </mtapp:statusmsg>
    </mt:if>
    
    <mt:if name="ping_errors">
        <mtapp:statusmsg
            id="ping-errors"
            class="alert">
            <__trans phrase="One or more errors occurred when sending update pings or TrackBacks."> <mt:if name="can_view_log"><__trans phrase="_USAGE_VIEW_LOG" params="<$mt:var name="script_url"$>?__mode=view_log&amp;blog_id=<$mt:var name="blog_id"$>"></mt:if>
        </mtapp:statusmsg>
    </mt:if>

    <mt:if name="saved_prefs">
        <mtapp:statusmsg    
            id="saved-prefs"
            class="success">
            <__trans phrase="Your customization preferences have been saved, and are visible in the form below.">
        </mtapp:statusmsg>
    </mt:if>

    <mt:if name="saved_comment">
        <mtapp:statusmsg    
            id="saved-comment"
            class="success"
            rebuild="all">
            <__trans phrase="Your changes to the comment have been saved.">
        </mtapp:statusmsg>
    </mt:if>

    <mt:if name="saved_notify">
        <mtapp:statusmsg    
            id="saved-notify"
            class="success">
            <__trans phrase="Your notification has been sent.">
        </mtapp:statusmsg>
    </mt:if>

    <mt:if name="recovered_object">
        <mtapp:statusmsg    
            id="recovered-object"
            class="success">
            <__trans phrase="You have successfully recovered your saved [_1]." params="<mt:var name="object_label">">
        </mtapp:statusmsg>
    </mt:if>
    </mt:if>

    <mt:if name="recovered_failed">
        <mtapp:statusmsg    
            id="recovered-failed"
            class="error">
            <__trans phrase="An error occurred while trying to recover your saved [_1]." params="<mt:var name="object_label">">
        </mtapp:statusmsg>
    </mt:if>
    </mt:if>

    <mt:if name="saved_deleted">
        <mtapp:statusmsg    
            id="saved-deleted"
            class="success">
            <__trans phrase="You have successfully deleted the checked comment(s).">
        </mtapp:statusmsg>
    </mt:if>

    <mt:if name="saved_deleted_ping">
        <mtapp:statusmsg    
            id="saved-deleted-ping"
            class="success">
            <__trans phrase="You have successfully deleted the checked TrackBack(s).">
        </mtapp:statusmsg>
    </mt:if>
    </div>
</mt:setvarblock>
<mt:setvarblock name="related_content">
    <mt:unless name="new_object">
        <mtapp:widget
            id="entry-summary-widget"
            label="<__trans phrase="Summary">">
            <p><__trans phrase="Created [_1] by [_2]." params="<$mt:date ts="$created_on_ts" relative="1" _default="$created_on_formatted"$>%%<$mt:var name="created_by" escape="html"$>"></p>
            <mt:if name="modified_by">
            <p><__trans phrase="Last edited [_1] by [_2]." params="<$MTDate ts="$modified_on_ts" relative="1" _default="$modified_on_formatted"$>%%<$mt:var name="modified_by" escape="html"$>"></p>
            </mt:if>
            <mt:if name="status_publish">
                <p><__trans phrase="Published [_1]." params="<$MTDate ts="$authored_on_ts" relative="1" _default="$authored_on_formatted"$>"></p>
            </mt:if>
            <p><__trans phrase="This [_1] has received <a href="[_4]">[quant,_2,comment,comments]</a> and <a href="[_5]">[quant,_3,trackback,trackbacks]</a>." params="<$mt:var name="object_label" lower_case="1"$>%%<$mt:var name="num_comments"$>%%<$mt:var name="num_pings"$>%%<$mt:var name="script_url">?__mode=list_comments&amp;filter_key=_comments_by_entry&amp;filter_val=<$mt:var name="id"$>&amp;blog_id=<$mt:var name="blog_id"$>%%<$mt:var name="script_url">?__mode=list_pings&amp;filter=entry_id&amp;filter_val=<$mt:var name="id"$>&amp;blog_id=<$mt:var name="blog_id"$>"></p>
        </mtapp:widget>
    </mt:unless>
    <mtapp:widget
        id="display-options-widget"
        label="<__trans phrase="Display Options">"
        label_link="javascript:void(0)"
        label_onclick="return toggleEntryDisplayOptions();">

        <form name="display-options-form" method="post" action="<mt:var name="script_url">">
            <input type="hidden" id="entry_prefs" name="entry_prefs" value="<mt:if name="disp_prefs_default">Default<mt:else>Custom</mt:if>">
                <mtapp:setting
                    id="entry_fields"
                    label="<__trans phrase="Fields">"
                    label_class="display-options">
                    <ul>
                        <li><label><input type="checkbox" name="custom_prefs" id="custom-prefs-title" value="title" checked="checked" disabled="disabled" class="cb" /> <__trans phrase="Title"></label></li>
                        <li><label><input type="checkbox" name="custom_prefs" id="custom-prefs-body" value="body" checked="checked" disabled="disabled" class="cb" /> <__trans phrase="Body"></label></li>
                        <li><label><input type="checkbox" onclick="setCustomFields(); return true;" name="custom_prefs" id="custom-prefs-tags" value="tags" <mt:if name="disp_prefs_show_tags"> checked="checked"</mt:if> class="cb" /> <__trans phrase="Tags"></label></li>
                        <mt:if name="object_type" ne="page">
                        <li><label><input type="checkbox" name="custom_prefs" id="custom-prefs-category" value="category" onclick="setCustomFields(); return true"<mt:if name="disp_prefs_show_category"> checked="checked"</mt:if> class="cb" /> <__trans phrase="Category"></label></li>
                        </mt:if>
                        <li><label><input type="checkbox" name="custom_prefs" id="custom-prefs-excerpt" value="excerpt" onclick="setCustomFields(); return true"<mt:if name="disp_prefs_show_excerpt"> checked="checked"</mt:if> class="cb" /> <__trans phrase="Excerpt"></label></li>
                        <li><label><input type="checkbox" name="custom_prefs" id="custom-prefs-keywords" value="keywords" onclick="setCustomFields(); return true"<mt:if name="disp_prefs_show_keywords"> checked="checked"</mt:if> class="cb" /> <__trans phrase="Keywords"></label></li>
                        <li><label><input type="checkbox" name="custom_prefs" id="custom-prefs-publishing" value="publishing" onclick="setCustomFields(); return true"<mt:if name="disp_prefs_show_publishing"> checked="checked"</mt:if> class="cb" /> <__trans phrase="Publishing"></label></li>
                        <li><label><input type="checkbox" name="custom_prefs" id="custom-prefs-feedback" value="feedback" onclick="setCustomFields(); return true"<mt:if name="disp_prefs_show_feedback"> checked="checked"</mt:if> class="cb" /> <__trans phrase="Feedback"></label></li>
                    </ul>
                </mtapp:setting>
                <mtapp:setting
                    id="action_bars"
                    label="<__trans phrase="Actions">"
                    label_class="display-options">
                    <ul class="action-button-options">
                        <li><label><input type="radio" name="bar_position" value="Top"<mt:unless name="position_actions_both"><mt:if name="position_actions_top"> checked="checked"</mt:if></mt:unless> onclick="setBarPosition(this)" class="rb" /> <__trans phrase="Top"></label></li>
                        <li><label><input type="radio" name="bar_position" value="Both"<mt:if name="position_actions_both"> checked="checked"</mt:if> onclick="setBarPosition(this)" class="rb" /> <__trans phrase="Both"></label></li>
                        <li><label><input type="radio" name="bar_position" value="Bottom"<mt:unless name="position_actions_both"><mt:if name="position_actions_bottom"> checked="checked"</mt:if></mt:unless> onclick="setBarPosition(this)" class="rb" /> <__trans phrase="Bottom"></label></li>
                    </ul>
                </mtapp:setting>
            <input type="button" onclick="saveEntryFieldOptions(); return toggleEntryDisplayOptions();" name="save_and_close" value="<__trans phrase="OK">" />
            <input type="button" name="reset_defaults" value="<__trans phrase="Reset">" onclick="setFieldGroup('Default'); return true" />
        </form>
    </mtapp:widget>
</mt:setvarblock>
<mt:setvarblock name="js_include" append="1">
    <!--// this MUST loaded after mt.js // -->
    <script type="text/javascript" src="<$mt:var name="static_uri"$>js/edit.js?v=<$mt:var name="mt_version" escape="url"$>"></script>
</mt:setvarblock>
<mt:setvarblock name="html_head" append="1">
    <script type="text/javascript" src="<$mt:var name="static_uri"$>js/common/DOM/Proxy.js?v=<$mt:var name="mt_version" escape="url"$>"></script>
    <script type="text/javascript" src="<$mt:var name="static_uri"$>js/common/SelectionRange.js?v=<$mt:var name="mt_version" escape="url"$>"></script>
    <script type="text/javascript" src="<$mt:var name="static_uri"$>js/common/Editor.js?v=<$mt:var name="mt_version" escape="url"$>"></script>
    <script type="text/javascript" src="<$mt:var name="static_uri"$>js/common/Editor/Iframe.js?v=<$mt:var name="mt_version" escape="url"$>"></script>
    <script type="text/javascript" src="<$mt:var name="static_uri"$>js/common/Editor/Textarea.js?v=<$mt:var name="mt_version" escape="url"$>"></script>
    <script type="text/javascript" src="<$mt:var name="static_uri"$>js/common/Editor/Toolbar.js?v=<$mt:var name="mt_version" escape="url"$>"></script>
    <link rel="stylesheet" type="text/css" href="<$mt:var name="static_uri"$>css/editor/editor.css?v=<$mt:var name="mt_version" escape="url"$>" />
    <script type="text/javascript" src="<$mt:var name="static_uri"$>js/tc/focus.js"></script>
    <script type="text/javascript" src="<$mt:var name="static_uri"$>js/tc/tagcomplete.js"></script>
    <script type="text/javascript" src="<$mt:var name="static_uri"$>js/tc/client.js"></script>

    <script type="text/javascript">
    /* <![CDATA[ */
var cur_text_format = '<mt:var name="convert_breaks" escape="js">';
var customizable_fields = new Array(<mt:unless name="object_type" eq="page">'category',</mt:unless>'excerpt','keywords','tags','publishing','feedback');
var default_fields = new Array();
<mt:loop name="disp_prefs_default_fields">
default_fields.push('<mt:var name="name" escape="js">');
</mt:loop>
var custom_fields = new Array();
<mt:unless name="object_type" eq="page">
<mt:if name="disp_prefs_show_category">custom_fields.push('category');</mt:if>
</mt:unless>
<mt:if name="disp_prefs_show_excerpt">custom_fields.push('excerpt');</mt:if>
<mt:if name="disp_prefs_show_keywords">custom_fields.push('keywords');</mt:if>
<mt:if name="disp_prefs_show_tags">custom_fields.push('tags');</mt:if>
<mt:if name="disp_prefs_show_publishing">custom_fields.push('publishing');</mt:if>
<mt:if name="disp_prefs_show_feedback">custom_fields.push('feedback');</mt:if>

function savedEntryOptions(c) {
    showMsg('<__trans phrase="Your entry screen preferences have been saved." escape="js">', 'saved-prefs-msg', 'success');
}

function saveEntryFieldOptions() {
    var frm = document.forms['display-options-form'];
    var entry_prefs = getByID('entry_prefs');
    var mode;
    mode = entry_prefs.value;

    var custom_prefs = '';
    var bar_position;
    for (var i = 0; i < frm.elements.length; i++) {
        var fld = frm.elements[i];
        if (fld.name == 'bar_position') {
            if (fld.checked) bar_position = fld.value;
        } else if (fld.name == 'entry_prefs') {
            mode = fld.value;
        } else if (fld.name == 'custom_prefs') {
            if (!fld.disabled && fld.checked)
                custom_prefs += '&custom_prefs=' + fld.value;
        }
    }
    // TBD: we need to get the blog id from the selector control
    // itself
    var param = '__mode=save_entry_prefs'
        + '&_type=<mt:var name="object_type">'
        + '&blog_id=<mt:var name="blog_id">'
        + '&entry_prefs=' + mode
        + '&magic_token=<mt:var name="magic_token">';
    if (mode == 'Custom') {
        param += custom_prefs;
        param += '&bar_position=' + bar_position;
    }
    var params = { uri: '<mt:var name="script_url">', method: 'POST', arguments: param, load: savedEntryOptions };
    TC.Client.call(params);
}

function convertedText(c, result) {
    var form = document.forms['entry_form'];
    var response = eval('('+result+')');
    if (response.error) {
        alert("Error: " + response.error);
        return;
    }

    form.text.value = response.result.text;
    form.text_more.value = response.result.text_more;
    cur_text_format = 'richtext';
    TC.removeClassName(TC.elementOrId("editor-content"), "editor-plaintext");
    var editor = app.editor;
    if (editor) {
        editor.setHTML( app.editorInput[ app.currentEditor ].value );
        editor.setMode('iframe');
        app.editor.iframe.focus();
    }
}

function changedTextFormat(sel) {
    var form = sel.form;
    var option = sel.options[sel.selectedIndex].value;
    if ((cur_text_format != 'richtext') && (option == 'richtext')) {
        // warn user that changing to richtext is not reversible (easily)
        if (!confirm("<__trans phrase="Are you sure you want to use the Rich Text editor?">")) {
            // revert selection
            for (var i = 0; i < sel.options.length; i++) {
                if (sel.options[i].value == cur_text_format)
                    sel.selectedIndex = i;
            }
            app.editor.element.focus();
            return;
        }
    }
    if (cur_text_format == 'richtext') {
        // changing to plaintext editor
        TC.addClassName(TC.elementOrId("editor-content"), "editor-plaintext");
        cur_text_format = option;
        app.editor.setMode('textarea');
        app.editor.textarea.focus();
    } else if (option == 'richtext') {
        app.saveHTML(false);
        // changing to richtext editor
        // convert existing format to richtext
        var param = {
            '__mode': 'convert_to_html',
            'text': form.text.value,
            'text_more': form.text_more.value,
            'format': cur_text_format
        };
        var params = {
            uri: '<mt:var name="script_url">', method: 'POST',
                arguments: param, load: convertedText
        };
        TC.Client.call(params);
    } else {
        cur_text_format = option;
        app.editor.textarea.focus();
    }
}

function setFieldGroup(selection) {
    var i, j, selected_fields, disable_fields, field_object;
    var entry_prefs = getByID('entry_prefs');
    entry_prefs.value = selection;
 
    // set checkbox data based on which group was selected
    if (selection == 'Default') {
        selected_fields = default_fields;
    } else if (selection == 'Custom') {
        selected_fields = custom_fields;
    }

    // uncheck all the checkboxes
    for (i = 0; i < customizable_fields.length; i++) {
        field_object = TC.elementOrId("custom-prefs-"+customizable_fields[i]);
        if (field_object) field_object.checked = false;
        var div = TC.elementOrId(customizable_fields[i] + '-field');
        if (div)
            TC.addClassName(div, 'hidden');
    }

    // check only the checkboxes in the current set
    if (selected_fields) {
        for (i = 0; i < selected_fields.length; i++) {
            for (j = 0; j < customizable_fields.length; j++) {
                if (selected_fields[i] == customizable_fields[j]) {
                    field_object = TC.elementOrId("custom-prefs-"+customizable_fields[j]);
                    var hide = true;
                    if (field_object) {
                        hide = false;
                        field_object.checked = true;
                    }
                    var div = TC.elementOrId(customizable_fields[j] + '-field');
                    if (div) {
                        if (hide)
                            TC.addClassName(div, 'hidden');
                        else
                            TC.removeClassName(div, 'hidden');
                    }
                }
            }
        }
    }

    return false;
}

function setCustomFields() {
    var i = 0;

    // empty the custom fields array
    custom_fields = new Array();

    // we loop over all customizable fields here (which includes
    // all the metadata fields). we want to hide the metadata (or
    // other fieldset, if we grow another customizable fieldset)
    // from view if all fields within it are hidden. alternatively,
    // if the user enables a field, the fieldset should be enabled.

    var fieldsets = DOM.getElementsByTagAndAttribute(document, "fieldset", "mt:fields");
    var fs_state = {};
    var fs_map = {};
    for (var i = 0; i < fieldsets.length; i++) {
        var fieldset = fieldsets[i];
        var idents = fieldset.getAttribute("mt:fields");
        if (idents) {
            fs_state[fieldset.id] = 'hidden';
            var identlist = idents.split(/\s+/);
            if (identlist && identlist.length) {
                for (var j = 0; j < identlist.length; j++)
                    fs_map[identlist[j]] = fieldset;
            }
        }
    }

    // add only the fields which are currently checked and enabled
    for (i = 0; i < customizable_fields.length; i++) {
        var hide = true;
        var field_object = TC.elementOrId("custom-prefs-"+customizable_fields[i]);

        if (field_object && field_object.checked && !field_object.disabled) {
            custom_fields.push(customizable_fields[i]);
            hide = false;
        }
        var div = TC.elementOrId(customizable_fields[i] + '-field');
        if (div) {
            var fieldset = fs_map[customizable_fields[i]];
            
            if (hide) {
                TC.addClassName(div, 'hidden');
            } else {
                if (fieldset) fs_state[fieldset.id] = null;
                TC.removeClassName(div, 'hidden');
            }
        }
    }

    for (var i = 0; i < fieldsets.length; i++) {
        var state = fs_state[fieldsets[i].id];
        if (state == 'hidden')
            TC.addClassName(fieldsets[i], "hidden");
        else
            TC.removeClassName(fieldsets[i], "hidden");
    }

    var entry_prefs = getByID('entry_prefs');
    entry_prefs.value = 'Custom';

    return false;
}

var tag_delim = '<$mt:var name="auth_pref_tag_delim"$>';
function setDirty () {
    log.warn('deprecated function setDirty(), call app.setDirty instead');
    app.setDirty();
}
function clearDirty () {
    log.warn('deprecated function clearDirty(), call app.clearDirty instead');
    app.clearDirty();
}

Editor.strings.unsavedChanges = '<__trans phrase="You have unsaved changes to your [_1] that will be lost." escape="singlequotes" params="<$mt:var name="object_label" lower_case="1"$>">'; 

// array of tag names
var tagList;
// raw structure of tags (hash of tag -> count)
var tags;

function rebasename(title) {
    if (!orig_basename) {
        dir_title = dirify(title.value);
        dir_title = dir_title.substring(0, <$mt:var name="basename_limit"$>);
        trimmed = dir_title.match(/^(.*[^_])/);
        if (trimmed && trimmed.length) {
            setElementValue('basename', trimmed[0]);
        } else {
            setElementValue('basename', '');
        }
    }
}

RegExp.escape = (function() {
  var specials = [
    '/', '.', '*', '+', '?', '|',
    '(', ')', '[', ']', '{', '}', '\\'
  ];

  sRE = new RegExp(
    '(\\' + specials.join('|\\') + ')', 'g'
  );
  
  return function(text) {
    return text.replace(sRE, '\\$1');
  }
})();

function tagSplit(str) {
    var delim = RegExp.escape(tag_delim);
    var delim_scan = new RegExp('^((([\'"])(.*?)\\3[^' + delim + ']*?|.*?)(' + delim + '\\s*|$))', '');
    str = str.replace(/(^\s+|\s+$)/g, '');
    var tags = [];
    while (str.length && str.match(delim_scan)) {
        str = str.substr(RegExp.$1.length);
        var tag = RegExp.$4 ? RegExp.$4 : RegExp.$2;
        tag = tag.replace(/(^\s+|\s+$)/g, '');
        tag = tag.replace(/\s+/g, ' ');
        if (tag != '') tags.push(tag);
    }
    return tags;
}

document.onkeyup = function(e) {
    if (!e) e = window.event;
    if (e.ctrlKey) {
        if (e.keyCode == 80) {
            if (e.shiftKey) {
                getByID('status').value = 1; // ctrl-shift-p: unpublish
            } else {
                getByID('status').value = 2; // ctrl-p: publish
            }
        }
        if (e.keyCode == 85) {
            getByID('status').value = 1; // ctrl-u: unpublish
        }
    }
};

var docs = new Array();
<mt:loop name="text_filters">
docs['<$mt:var name="filter_key"$>'] = '<$mt:var name="filter_docs"$>';
</mt:loop>
function openTFDocs () {
    var s = document.forms['entry_form'].convert_breaks;
    var key = s.options[s.selectedIndex].value;
    if (url = docs[key]) {
        if (url.indexOf('http://') == -1)
            url = HelpBaseURI + url;
        window.open(url, 'manual', 'width=450,height=550,scrollbars=yes,status=yes,resizable=yes');
    } else {
        return openManual('entries', 'entry_text_formatting');
    }
}

function toggleFile() {
    var fld = getByID("basename");
    if (fld) {
        fld.disabled = false;
        fld.focus();
        var baseman = getByID("basename_manual");
        if (baseman) baseman.value = "1";
        var basewarn = getByID("basename-warning");
        if (basewarn) basewarn.style.display = "block";
    }
    var img = getByID("basename-lock");
    if (img)
        img.style.display = 'none';
    return false;
}

var orig_basename;
var tbTableSelect;
var cmtTableSelect;
var autoTag;
<mt:if name="tags_js">
tags = <$mt:var name="tags_js"$>;
</mt:if>
function init() {
    // setup
    tbTableSelect = new TC.TableSelect( "manage-trackbacks" );
    tbTableSelect.rowSelect = true;
    cmtTableSelect = new TC.TableSelect( "manage-comments" );
    cmtTableSelect.rowSelect = true;
    var basename = getByID("basename");
    var basename_old = getByID("basename_old");
    var title = getByID("title");
    if (basename) {
        if (basename.value != '') {<mt:if name="reedit">
            toggleFile();</mt:if>
            orig_basename = basename.value;
        }<mt:if name="reedit"> else {
            <mt:if name="id">
            basename.value = basename_old.value;
            <mt:else>
            basename.value = dirify(title.value);
            </mt:if>
        }
</mt:if>
    }
    var el = getByID("dialog-container");
    if (navigator.appVersion.indexOf('MSIE') != -1) {
        var temp = navigator.appVersion.split('MSIE');
        var version = parseFloat(temp[1]);
    }
    if (version < 7) {
    if (el) el.style.position = '';
    } else {
        if (el) el.style.position = 'fixed';
    }
    <mt:if name="defer_tag_load">window.setTimeout("deferredTagLoad()", 500);<mt:else>
    <mt:if name="tags_js">initTags();</mt:if></mt:if>
    <mt:unless name="id">title.focus();</mt:unless>
}

<mt:if name="defer_tag_load">
function deferredTagLoad() {
    /* http://del.icio.us/feeds/json/tags/username */
    TC.Client.call({
        'load': tagsLoaded,
        'method': 'POST',
        'uri': '<$mt:var name="mt_url"$>',
        'arguments': { '__mode': 'js_tag_list',
            'blog_id': '<$mt:var name="blog_id"$>',
            'magic_token': '<$mt:var name="magic_token"$>'}
    });
}

function tagsLoaded(c, result) {
    try {
        var x = eval('(' + result + ')');
        if (x.error) {
            // suppress error. tag completion isn't critical
            return;
        }
        tags = x.result.tags;
    } catch (e) {
    }
    initTags();
}
</mt:if>

var tagPos = 0;
function initTags() {
    /* browsers don't want to cache the tags field, so we use a hidden input field to cache them */
    var t = getByID('tags-cache');
    if ( t ) {
        log('tag cache:'+t.value);
        var v = getByID('tags');
        if ( t.value )
            v.value = t.value;
        DOM.addEventListener( v, "change", function() { log('caching tags'); t.value = v.value; } );
    }
    if (!tags || tags.length == 0) return;

    tagList = [];
    for (var tag in tags)
        if ( tags.hasOwnProperty( tag ) )
            tagList.push( tag );
    autoTag = new TC.TagComplete("tags", tagList);
    autoTag.delimiter = tag_delim;
}

TC.attachLoadEvent( init );

function highlightSwitch(selection) {
    var descriptionObject = getByID('created_on-label');
    var highlightObject = getByID('created_on-date');
    if (highlightObject) {
        if (selection.value == 4) {
            highlightObject.className = 'highlight';
            descriptionObject.innerHTML = '<__trans phrase="Publish On">';
        } else {
            highlightObject.className = 'default';
            descriptionObject.innerHTML = '<__trans phrase="Publish Date">';
        }
    }
    return false;
}

function doValidateNotifyRecips(f) {
    if (f.send_notify_list && f.send_notify_list.checked)
        return true

    if (f.send_notify_emails && !f.send_notify_emails.value) {
        alert('<__trans phrase="You must specify at least one recipient." escape="singlequotes">');
        return false;
    }

    return true;
}
    Template.templates.autoSave = '<mt:section encode_js="1">
    [# if ( saving ) { #]
        [#= trans("Auto-saving..." ) #]
    [# } else { #]
        [#= trans("Last auto-save at [_1]:[_2]:[_3]", hh, mm, ss ) #]
    [# } #]
    </mt:section>';
    <mt:ignore>
        <__trans phrase="Remove">
        <__trans phrase="Make primary">
    </mt:ignore>
/* ]]> */
        </script>
</mt:setvarblock>
<mt:setvarblock name="html_body" append="1">
<script type="text/javascript">
    /* <![CDATA[ */
        <mt:if name="dirty">
        MT.App.dirty = true;
        </mt:if>
        MT.App.categoryList = <$mt:if name="category_tree"><$mt:var name="category_tree" to_json="1"$><mt:else>[]</mt:if>;
        Template.templates.categorySelectorList = '<mt:section encode_js="1">
                [# DOM.addClassName( div, "pkg" ) #]
                [# if ( item.path == null ) item.path = [] #]
                <div style="text-align:left; margin-left:[#= item.path.length * 10 #]px">
                    <a href="javascript:void(0);" mt:id="[#= item.id #]" mt:command="show-add-category" class="add-category-new-link"><span>Add</span>&nbsp;</a><input type="<mt:if name="object_type" eq="page">radio<mt:else>checkbox</mt:if>" name="<mt:if name="object_type" eq="entry">add_</mt:if>category_id<mt:if name="object_type" eq="entry">_[#= item.id #]</mt:if>" class="add-category-checkbox" <mt:if name="category_is_selected">checked="checked"</mt:if> />
                    <label style="width: [#= 230 - (item.path.length * 10) #]px;">[#|h item.label #]</label>
                </div>
        </mt:section>';
        Template.templates.categorySelectorAddForm = '<mt:section encode_js="1">
        [# div.className="add-category-form hidden" #]<input id="add-category-input-movable" class="add-category-input input-hint" type="text" value="[#|h trans( "Add sub category" ) #]" mt:default="[#|h trans( "Add sub category" ) #]" mt:delegate="default-value" /> <a href="javascript:void(0);" mt:command="add" class="add-category-save-link"><span>Add</span>&nbsp;</a><a href="javascript:void(0);" mt:command="cancel" class="add-category-cancel-link"><span>[#|h trans( "Cancel" ) #]</span>&nbsp;</a>
        </mt:section>';
    <mt:ignore>
        <__trans phrase="Add sub category">
        <__trans phrase="Cancel">
    </mt:ignore>
    /* ]]> */
</script>
<mt:include name="include/calendar.tmpl">
    <div id="<$mt:var name="container_type" lower_case="1"$>-selector" class="category-selector <mt:if name="object_type" eq="page">autolayout-flyout-smart<mt:else>autolayout-flyout-left-from-right</mt:if> flyout"><div id="<$mt:var name="container_type" lower_case="1"$>-selector-inner" class="inner">
        <h3><$mt:var name="container_label_plural"$></h3>
        <div id="add-category-form" class="add-category-form hidden"><input id="add-category-input" class="add-category-input input-hint" type="text" value="<__trans phrase="Add [_1] name" params="<$mt:var name="container_label" lower_case="1"$>">" mt:default="<__trans phrase="Add [_1] name" params="<$mt:var name="container_label" lower_case="1"$>">" mt:delegate="default-value" /> <a href="javascript:void(0);" mt:command="add" class="add-category-save-link"><span>Add</span>&nbsp;</a><a href="javascript:void(0);" mt:command="cancel" class="add-category-cancel-link"><span>Cancel</span>&nbsp;</a></div>
        <div id="<$mt:var name="container_type" lower_case="1"$>-selector-list" class="category-selector-list">
        </div>
<mt:if name="object_type" eq="entry">
        <a class="add-category-new-parent-link" mt:command="show-add-category" href="javascript:void(0);" title="<__trans phrase="Add new parent [_1]" params="<$mt:var name="container_label" lower_case="1"$>">"><__trans phrase="Add new"></a>
</mt:if>
        <a class="add-category-ok-link" href="javascript:void(0)" mt:command="close"><__trans phrase="OK"></a>
    </div></div><!-- /category-selector -->

</mt:setvarblock>
<mt:setvartemplate name="action_buttons">
    <button type="submit" accesskey="s" title="<__trans phrase="Save this [_1] (s)" params="<mt:var name="object_label" lower_case="1">">" mt:mode="save_entry" class="positive"><__trans phrase="Save"></button>
    <button type="submit" accesskey="v" title="<__trans phrase="Preview this [_1] (v)" params="<mt:var name="object_label" lower_case="1">">" mt:mode="preview_entry" name="preview_entry"><__trans phrase="Preview"></button>
    <mt:ignore>
    <input type="submit" value="<__trans phrase="Save">" accesskey="s" title="<__trans phrase="Save this [_1] (s)" params="<mt:var name="object_label" lower_case="1">">" mt:mode="save_entry" />
    <input type="submit" name="preview_entry" value="<__trans phrase="Preview">" accesskey="v" title="<__trans phrase="Preview this [_1] (v)" params="<mt:var name="object_label" lower_case="1">">" mt:mode="preview_entry" />
    </mt:ignore>
    <mt:if name="id">
    <button type="submit" accesskey="x" mt:command="do-remove-items" mt:object-singular="<mt:var name="object_label" lower_case="1" escape="html">" mt:object-plural="<mt:var name="object_label_plural" lower_case="1" escape="html">" mt:object-type="<mt:var name="object_type" escape="html">" mt:blog-id="<mt:var name="blog_id">" title="<__trans phrase="Delete this [_1] (v)" params="<mt:var name="object_label" lower_case="1">">" class="negative"><__trans phrase="Delete"></button>
        <mt:ignore>
    <input accesskey="x" onclick="clearDirty(); doRemoveItems(this.form, '<mt:var name="object_label" lower_case="1" escape="js">', '<mt:var name="object_label_plural" lower_case="1" escape="js">', false, { 'return_args': '__mode=list_<mt:var name="object_type">&amp;blog_id=<mt:var name="blog_id">' }); return true" type="button" value="<__trans phrase="Delete">" title="<__trans phrase="Delete this [_1] (x)" params="<mt:var name="object_label" lower_case="1">">" />
        </mt:ignore>
    </mt:if>
    <div id="autosave-notification-area-<$mt:var name="bar_position" default="top"$>" class="autosave-notification-area"></div>
</mt:setvartemplate>

<mt:include name="include/header.tmpl" id="header_include">
<form name="entry_form" id="entry_form" method="post" action="<$mt:var name="script_url"$>" mt:once="1" mt:auto-save="1">
<mt:if name="new_object">
    <input type="hidden" name="author_id" value="<$mt:var name="author_id"$>" />
<mt:else>
    <input type="hidden" name="id" value="<$mt:var name="id"$>" />
</mt:if>
    <input type="hidden" name="blog_id" value="<$mt:var name="blog_id"$>" />
    <input type="hidden" name="__mode" value="save_entry" />
    <input type="hidden" name="_type" value="<$mt:var name="object_type"$>" />
    <input type="hidden" name="return_args" value="<$mt:var name="return_args" escape="html"$>" />
    <input type="hidden" name="magic_token" value="<$mt:var name="magic_token"$>" id="m_t" />
    <input type="hidden" name="action_name" value="" />
    <input type="hidden" name="itemset_action_input" value="" />
    <mt:if name="id">
    <div id="entry-nav" class="pkg">
        <ul class="inline-nav right">
<mt:ignore>
            <mt:if name="can_send_notifications">
            <li><a href="javascript:void(0)"><__trans phrase="Share this [_1]" params="<$mt:var name="object_label" lower_case="1"$>"></a></li>
            </mt:if>
</mt:ignore>
            <mt:if name="status_publish">
                <mt:if name="entry_permalink">
            <li class="view-entry-link"><a href="<$mt:var name="entry_permalink"$>" target="<__trans phrase="_external_link_target">"><__trans phrase="View published [_1]" params="<$mt:var name="object_label" lower_case="1"$>"></a></li>
                </mt:if>
            </mt:if>
        </ul>
        <ul class="inline-nav left">
            <li id="previous-link"><mt:if name="previous_entry_id"><a href="<$mt:var name="script_url"$>?__mode=view&amp;_type=<$mt:var name="object_type" lower_case="1"$>&amp;id=<$mt:var name="previous_entry_id"$>&amp;blog_id=<$mt:var name="blog_id"$>"><__trans phrase="&laquo; Previous"></a><mt:else><__trans phrase="&laquo; Previous"></mt:if></li>
            <li><a href="<$mt:var name="script_url"$>?__mode=list_<$mt:var name="object_type" lower_case="1"$>&amp;blog_id=<$mt:var name="blog_id"$>"><__trans phrase="Manage [_1]" params="<$mt:var name="object_label_plural"$>"></a></li>
            <li id="next-link"><mt:if name="next_entry_id"><a href="<$mt:var name="script_url"$>?__mode=view&amp;_type=<$mt:var name="object_type" lower_case="1"$>&amp;id=<$mt:var name="next_entry_id"$>&amp;blog_id=<$mt:var name="blog_id"$>"><__trans phrase="Next &raquo;"></a><mt:else><__trans phrase="Next &raquo;"></mt:if></li>
        </ul>
    </div>
    </mt:if>

    <mt:include name="include/actions_bar.tmpl" hide_pager="1">

    <mtapp:setting
        id="title"
        label="<__trans phrase="Tags">"
        label_class = "no-header"
        help_page="entries"
        help_section="entry_title">
        <input name="title" id="title" tabindex="1" value="<$mt:var name="title" escape="html"$>" maxlength="255" mt:watch-change="1" onchange="rebasename(this)" />
    </mtapp:setting>

        <div id="editor">
            <div class="editor-header pkg" mt:delegate="tab-container">
                <div class="tab selected-tab" mt:command="set-editor-content" mt:tab="content">
                    <label><a href="javascript:void(0);"><__trans phrase="Body"></a></label>
                </div>
                <div class="tab" mt:command="set-editor-extended" mt:tab="extended">
                    <label><a href="javascript:void(0);"><__trans phrase="Extended"></a></label>
                </div>

                <!-- text filters -->
                <div id="field-convert_breaks" align="right">
                    <__trans phrase="Format">:
                    <select name="convert_breaks" id="convert_breaks" tabindex="2" style="font-size: 10px" onchange="changedTextFormat(this)">
    <mt:loop name="text_filters">
                        <option value="<mt:var name="filter_key">"<mt:if name="filter_selected"> selected="selected"</mt:if>><mt:var name="filter_label"></option>
    </mt:loop>
                    </select>
                </div>

            </div>
        </div>
        <div id="editor-content" class="editor-content<mt:if name="convert_breaks" ne="richtext"> editor-plaintext</mt:if>">
            <div id="formatted" class="editor-panel">
                <div id="entry-body-field" class="field">
                    <div class="field-content">
                        <div id="editor-content-toolbar" class="field-buttons editor-toolbar">
                            <div class="field-buttons-formatting pkg">
                                <a href="javascript: void 0;" title="<__trans phrase="Decrease Text Size" escape="singlequotes">" class="command-font-size-smaller toolbar button"><b>a</b><s></s></a>
                                <a href="javascript: void 0;" title="<__trans phrase="Increase Text Size" escape="singlequotes">" class="command-font-size-larger toolbar button"><b>A</b><s></s></a>
                                <a href="javascript: void 0;" title="<__trans phrase="Bold" escape="singlequotes">" class="command-bold toolbar button"><b>B</b><s></s></a>
                                <a href="javascript: void 0;" title="<__trans phrase="Italic" escape="singlequotes">" class="command-italic toolbar button"><b>I</b><s></s></a>
                                <a href="javascript: void 0;" title="<__trans phrase="Underline" escape="singlequotes">" class="command-underline toolbar button"><b>U</b><s></s></a>
                                <a href="javascript: void 0;" title="<__trans phrase="Strikethrough" escape="singlequotes">" class="command-strikethrough toolbar button"><b>S</b><s></s></a>
                                <!-- a href="javascript: void 0;" title="<__trans phrase="Text Color" escape="singlequotes">" class="command-color toolbar button"><b>Text Color</b><s></s></a -->
                                <a href="javascript: void 0;" title="<__trans phrase="Link" escape="singlequotes">" class="command-insert-link toolbar button"><b>Link</b><s></s></a>
                                <a href="javascript: void 0;" title="<__trans phrase="Email Link" escape="singlequotes">" class="command-insert-email toolbar button"><b>Email Link</b><s></s></a>
                                <a href="javascript: void 0;" title="<__trans phrase="Begin Blockquote" escape="singlequotes">" class="command-indent toolbar button"><b>Begin Blockquote</b><s></s></a>
                                <a href="javascript: void 0;" title="<__trans phrase="End Blockquote" escape="singlequotes">" class="command-outdent toolbar button"><b>End Blockquote</b><s></s></a>
                                <a href="javascript: void 0;" title="<__trans phrase="Bulleted List" escape="singlequotes">" class="command-insert-unordered-list toolbar button"><b>Bulleted List</b><s></s></a>
                                <a href="javascript: void 0;" title="<__trans phrase="Numbered List" escape="singlequotes">" class="command-insert-ordered-list toolbar button"><b>Numbered List</b><s></s></a>
                                <!-- a href="javascript: void 0;" title="<__trans phrase="Left Align Item" escape="singlequotes">" class="command-enclosure-align-left toolbar button"><b>Left Align Item</b><s></s></a>
                                <a href="javascript: void 0;" title="<__trans phrase="Center Item" escape="singlequotes">" class="command-enclosure-align-center toolbar button"><b>Center Item</b><s></s></a>
                                <a href="javascript: void 0;" title="<__trans phrase="Right Align Item" escape="singlequotes">" class="command-enclosure-align-right toolbar button"><b>Right Align Item</b><s></s></a -->
                                <a href="javascript: void 0;" title="<__trans phrase="Left Align Text" escape="singlequotes">" class="command-justify-left toolbar button"><b>Left Align Text</b><s></s></a>
                                <a href="javascript: void 0;" title="<__trans phrase="Center Text" escape="singlequotes">" class="command-justify-center toolbar button"><b>Center Text</b><s></s></a>
                                <a href="javascript: void 0;" title="<__trans phrase="Right Align Text" escape="singlequotes">" class="command-justify-right toolbar button"><b>Right Align Text</b><s></s></a>
                                <!-- a href="javascript: void 0;" title="Spell Check" class="command-spell-check toolbar button"><b>Check Spelling</b><s></s></a-->
                                <a href="javascript: void 0;" title="<__trans phrase="Insert Image" escape="singlequotes">" mt:command="open-dialog" mt:dialog-params="__mode=list_assets&amp;_type=asset&amp;edit_field=<mt:var name="toolbar_edit_field">&amp;blog_id=<mt:var name="blog_id">&amp;dialog_view=1&amp;filter=class&amp;filter_val=image" class="command-insert-image toolbar button"><b>Insert Image</b><s></s></a>
                                <a href="javascript: void 0;" title="<__trans phrase="Insert File" escape="singlequotes">" mt:command="open-dialog" mt:dialog-params="__mode=list_assets&amp;_type=asset&amp;edit_field=<mt:var name="toolbar_edit_field">&amp;blog_id=<mt:var name="blog_id">&amp;dialog_view=1" class="command-insert-file toolbar button"><b>Insert File</b><s></s></a>
                                <a href="javascript: void 0;" title="<__trans phrase="WYSIWYG Mode" escape="singlequotes">" mt:command="set-mode-iframe" class="command-toggle-wysiwyg toolbar button"><b>WYSIWYG Mode</b><s></s></a>
                                <a href="javascript: void 0;" title="<__trans phrase="HTML Mode" escape="singlequotes">" mt:command="set-mode-textarea" class="command-toggle-html toolbar button"><b>HTML Mode</b><s></s></a>
                            </div>
                        </div>
                        <mt:setvarblock name="editor_content_height"><mt:if name="disp_prefs_height_body"><$mt:var name="disp_prefs_height_body"$><mt:else>194</mt:if></mt:setvarblock>
                        <div class="editor" id="editor-content-enclosure" mt:min-height="66" mt:update-field-height="editor-content-height" style="height: <$mt:var name="editor_content_height"$>px">
                            <textarea tabindex="3" id="editor-content-textarea" name="_text_" class="full-width" style="height: <$mt:var name="editor_content_height"$>px" mt:allow-tabs="1"></textarea>
                            <!-- the iframe bootstraps the js -->
                            <$mt:setvar name="delayed_bootstrap" value="1"$>
                            <iframe tabindex="3" id="editor-content-iframe" frameborder="0" scrolling="yes" src="<$mt:var name="static_uri"$>html/editor-content.html" style="height: <$mt:var name="editor_content_height"$>px"></iframe>
                            <input type="hidden" name="text_height" id="editor-content-height" value="<$mt:var name="editor_content_height"$>" />
                            <input type="hidden" id="editor-input-content" name="text" value="<$mt:var name="text" escape="html"$>" />
                            <input type="hidden" id="editor-input-extended" name="text_more" value="<$mt:var name="text_more" escape="html"$>" />
                            <div class="resizer" mt:delegate="resizer" mt:target="editor-content-enclosure" mt:lock="x">
                                <img src="<$mt:var name="static_uri"$>images/spacer.gif" width="100%" height="10"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

<mt:setvarblock name="show_metadata"><$mt:var name="disp_prefs_show_tags"$><mt:unless name="object_type" eq="page"><$mt:var name="disp_prefs_show_category"></mt:unless><$mt:var name="disp_prefs_show_excerpt"$><$mt:var name="disp_prefs_show_keywords"$></mtsetvarblock>
<fieldset id="entry-metadata-settings" mt:fields="tags <mt:unless name="object_type" eq="page">category </mt:unless>excerpt keywords" class="pkg<mt:unless name="show_metadata"> hidden</mt:unless>">

    <h3><__trans phrase="Metadata"></h3>

    <mt:if name="auth_pref_tag_delim_comma">
        <$mt:setvar name="tags_hint" value="<__trans phrase="(comma-delimited list)">"$>
    <mt:else>
        <mt:if name="auth_pref_tag_delim_space">
            <$mt:setvar name="tags_hint" value="<__trans phrase="(space-delimited list)">"$>
        <mt:else>
            <mt:setvarblock name="tags_hint">
                <__trans phrase="(delimited by '[_1]')" params="<$mt:var name="auth_pref_tag_delim"$>">
            </mt:setvarblock>
        </mt:if>
    </mt:if>
    <mtapp:setting
        id="tags"
        shown="$disp_prefs_show_tags"
        label="<__trans phrase="Tags">"
        help_page="entries"
        help_section="entry_tags">
        <div class="textarea-wrapper">
            <input name="tags" id="tags" class="full-width" tabindex="5" value="<$mt:var name="tags" escape="html"$>" mt:watch-change="1" autocomplete="off" />
            <input type="hidden" name="_ignore_tags" id="tags-cache" value="<$mt:var name="tags" escape="html"$>" />
        </div>
        <!-- FIXME - move this styling to the ie hacks css file -->
        <!--[if lte IE 6.5]><div style="position:relative;"><![endif]-->
        <div id="tags_completion"></div>
        <!--[if lte IE 6.5]></div><![endif]-->
    </mtapp:setting>

<mt:setvarblock name="category_setting">
    <mtapp:setting
        id="category"
        shown="$disp_prefs_show_category"
        label="$container_label"
        help_page="entries"
        help_section="entry_categories">
        <mt:if name="object_type" eq="page">
        <div mt:delegate="category-list" id="category-list"></div>
        <a href="javascript:void(0);" class="change-folder-link" mt:command="open-category-selector"><__trans phrase="Change [_1]" params="<$mt:var name="container_label" lower_case="1"$>"></a>
        <mt:else>
        <a href="javascript:void(0);" class="add-new-category-link" mt:command="open-category-selector"><__trans phrase="Add [_1]" params="<$mt:var name="container_label" lower_case="1"$>"></a>
        <div mt:delegate="category-list" id="category-list"></div>
        </mt:if>
        <input id="category-ids" type="hidden" name="category_ids" value="<$mt:var name="selected_category_loop" glue=","$>" />
    <script type="text/javascript">
        /* <![CDATA[ */
            MT.App.selectedCategoryList = <$mt:if name="selected_category_loop"><$mt:var name="selected_category_loop" to_json="1"$><mt:else>[]</mt:if>;
            Template.templates.categoryList = '<mt:section encode_js="1">
                [# if ( !items.length ) { #]
                    [#* return #]
                [# } #]
                <ul class="<$mt:var name="container_type" lower_case="1"$>-list pkg">
                [# var map = {}; #]
                [# for ( var i = 0; i < items.length; i++ ) { #]
                    [# if ( items[ i ] == 0 && i == 0 ) { #]
                        [#-- special case, no primary selected, but has secondaries --#]
                        [# continue #]
                    [# } #]
                    [# var cat = cache.getItem( "cat:"+items[ i ] ); #]
                    [# if ( !cat ) continue; #]
                    [# var label; #]
                    [# if ( cat.path.length ) {
                        label = [];
                        for ( var j = 0; j < cat.path.length; j++ ) {
                            var c = cache.getItem( "cat:"+cat.path[ j ] );
                            if ( c ) 
                                label.push( c.label );
                        }
                        label.push( cat.label );
                        for ( var j = 0; j < label.length; j++ )
                            label[ j ] = context.f.h( label[ j ] );
                        label = label.join( <mt:if name="object_type" ne="page">' &raquo; '<mt:else>''</mt:if> );
                    } else {
                        label = context.f.h( cat.label );
                    } #]
                    <mt:if name="object_type" ne="page">
                    [# if ( i == 0 ) { #]
                        <li class="primary pkg" mt:focus-hover="1" mt:id="[#= cat.id #]"><strong>[#= label #]</strong><a href="javascript:void(0);" mt:command="remove" class="delete" title="[#|h trans("Remove") #]">&nbsp;<span>[#|h trans("Remove") #]</span></a></li>
                    [# } else { #]
                        <li class="pkg" mt:focus-hover="1" mt:id="[#= cat.id #]"><mt:if name="object_type" eq="entry"><a mt:focus-hover="1" href="javascript:void(0);" mt:command="primary" class="primary" title="[#|h trans("Make primary") #]">[#= label #]</a></mt:if><a mt:focus-hover="1" href="javascript:void(0);" mt:command="remove" class="delete" title="[#|h "Remove" #]">&nbsp;<span>[#|h trans("Remove") #]</span></a></li>
                    [# } #]
                    <mt:else>
                    <li class="pkg" mt:focus-hover="1" mt:id="[#= cat.id #]">[#= label #]</li>
                    </mt:if>
                [# } #]
                </ul>
            </mt:section>';
        /* ]]> */
    </script>
    </mtapp:setting>
</mt:setvarblock>

<mt:if name="object_type" eq="entry">
    <$mt:var name="category_setting"$>
</mt:if>

    <mtapp:setting
        id="excerpt"
        shown="$disp_prefs_show_excerpt"
        label="<__trans phrase="Excerpt">"
        help_page="entries"
        help_section="excerpt">
        <textarea name="excerpt" id="excerpt" class="full-width short" tabindex="7" cols="" rows="" mt:watch-change="1"><$mt:var name="excerpt" escape="html"$></textarea>
    </mtapp:setting>

    <mtapp:setting
        id="keywords"
        shown="$disp_prefs_show_keywords"
        label="<__trans phrase="Keywords">"
        help_page="entries"
        help_section="keywords">
        <div class="textarea-wrapper">
            <input name="keywords" id="keywords" class="full-width" tabindex="8" value="<$mt:var name="keywords" escape="html"$>" mt:watch-change="1" autocomplete="off" />
        </div>
    </mtapp:setting>
</fieldset>

<fieldset id="publishing-field" class="pkg<mt:unless name="disp_prefs_show_publishing"> hidden</mt:unless>">

    <h3><__trans phrase="Publishing"></h3>

    <mtapp:setting
        id="status"
        label="<__trans phrase="Status">"
        help_page="entries"
        help_section="status">
        <mt:unless name="sitepath_configured">
                        <input type="hidden" name="status" id="status" value="1" /><span><__trans phrase="Unpublished"></span>&nbsp;<span class="alert-warning-inline"><img src="<$mt:var name="static_uri"$>images/status_icons/warning.gif" alt="<__trans phrase="Warning">" width="9" height="9" /> <a href="<$mt:var name="script_url"$>?__mode=view&amp;_type=blog&amp;id=<$mt:var name="blog_id"$>&amp;blog_id=<$mt:var name="blog_id"$>"><__trans phrase="You must configure blog before you can publish this [_1]." params="<mt:var name="object_label" lower_case="1">"></a></span>
        <mt:else>
            <mt:if name="can_publish_post">
                        <select name="status" id="status" class="full-width" tabindex="9" onchange="highlightSwitch(this)">
                            <option value="1"<mt:if name="status_draft"> selected="selected"</mt:if>><__trans phrase="Unpublished"></option>
                            <option value="2"<mt:if name="status_publish"> selected="selected"</mt:if>><__trans phrase="Published"></option>
                <mt:if name="new_object">
                                <option value="4"<mt:if name="status_future"> selected="selected"</mt:if>><__trans phrase="Scheduled"></option>
                <mt:else>
                    <mt:unless name="status_publish">
                            <option value="4"<mt:if name="status_future"> selected="selected"</mt:if>><__trans phrase="Scheduled"></option>
                    </mt:unless>
                </mt:if>
                </mt:if>
                        </select>
            <mt:else>
                <mt:if name="status_draft">
                        <input type="hidden" name="status" id="status" value="1" /><span><__trans phrase="Unpublished"></span>
                <mt:else>
                    <mt:if name="status_publish">
                        <input type="hidden" name="status" id="status" value="2" /><span><__trans phrase="Published"></span>
                    <mt:else>
                        <mt:if name="status_future">
                        <input type="hidden" name="status" id="status" value="4" /><span><__trans phrase="Scheduled"></span>
                        </mt:if>
                    </mt:if>
                </mt:if>
            </mt:if>
        </mt:unless>
    </mtapp:setting>

    <mt:if name="status_future">
        <$mt:setvar name="authored_on_label" value="<__trans phrase="Publish On">"$>
    <mt:else>
        <$mt:setvar name="authored_on_label" value="<__trans phrase="Publish Date">"$>
    </mt:if>
    <mtapp:setting
        id="authored_on"
        label="$authored_on_label"
        help_page="entries"
        help_section="date">
        <span class="<mt:if name="status_future"><mt:if name="can_publish_post">highlight</mt:if></mt:if>">
            <input id="created-on" class="entry-date" name="authored_on_date" tabindex="10" value="<$mt:var name="authored_on_date" escape="html"$>" />
            <a href="javascript:void(0);" mt:command="open-calendar-created-on" class="date-picker" title="<__trans phrase="Select entry date">"><span>Choose Date</span></a>
            <input class="entry-time" name="authored_on_time" tabindex="11" value="<$mt:var name="authored_on_time" escape="html"$>" />
        </span>
    </mtapp:setting>

<mt:if name="object_type" eq="page">
    <$mt:var name="category_setting"$>
</mt:if>

    <mtapp:setting
        id="basename"
        label="$basename_label"
        help_page="entries"
        help_section="basename">
            <input type="hidden" name="basename_manual" id="basename_manual" value="0" />
            <input type="hidden" name="basename_old" id="basename_old" value="<$mt:var name="basename_old" escape="html"$>" />
            <input type="text" <mt:if name="object_type" eq="entry">disabled="disabled"</mt:if> name="basename" id="basename" value="<$mt:var name="basename"$>" onchange="setElementValue('basename', dirify(this.value))" tabindex="12" />
        <mt:if name="object_type" eq="page">
        <$mt:var name="file_extension"$>
        </mt:if>
        <mt:if name="object_type" eq="entry">
            <mt:if name="can_publish_post">
            <a href="javascript:void(0);"id="basename-lock" title="<__trans phrase="Unlock this entry&rsquo;s output filename for editing">" onclick="return toggleFile()"><span>Unlock</span></a>
            </mt:if>
            <p class="alert-warning-inline" id="basename-warning" style="display: none">
                <img src="<$mt:var name="static_uri"$>images/status_icons/warning.gif" alt="<__trans phrase="Warning">" width="9" height="9" />
            <mt:if name="new_object">
                <__trans phrase="Warning: If you set the basename manually, it may conflict with another entry.">
            <mt:else>
                <__trans phrase="Warning: Changing this entry's basename may break inbound links.">
            </mt:if>
            </p>
        </mt:if>
    </mtapp:setting>
</fieldset>

<fieldset id="feedback-field" class="pkg<mt:unless name="disp_prefs_show_feedback"> hidden</mt:unless>">
    <h3><__trans phrase="Feedback"></h3>

    <mtapp:setting
        id="allow_feedback"
        label="<__trans phrase="Accept">"
        help_page="entries"
        help_section="accept_comments">
        <ul>
            <li><input type="checkbox" name="allow_comments" id="allow_comments" tabindex="14" value="1"<mt:if name="allow_comments"> checked="checked"</mt:if> class="cb" /> <__trans phrase="Comments Accepted"></li>
            <li><input type="checkbox" name="allow_pings" id="allow_pings" tabindex="15" value="1"<mt:if name="allow_pings"> checked="checked"</mt:if> class="cb" /> <__trans phrase="TrackBacks Accepted"></li>
        </ul>
    </mtapp:setting>

    <mtapp:setting
        id="ping_urls"
        label="<__trans phrase="Outbound TrackBack URLs">"
        help_page="entries"
        help_section="urls_to_ping">
            <textarea name="to_ping_urls" id="to_ping_urls" class="full-width short" tabindex="16" cols="" rows=""><$mt:var name="to_ping_urls" escape="html"$></textarea>
        <mt:unless name="new_object">
            <mt:if name="has_any_pinged_urls">
            <div id="sent-tb"><a href="javascript:void(0)" onclick="listPreviousPings(); return false"><__trans phrase="View Previously Sent TrackBacks"></a></div>
            </mt:if>
        </mt:unless>
    </mtapp:setting>
</fieldset>

<mt:include name="include/actions_bar.tmpl" bar_position="bottom" hide_pager="1">
</form>

<mt:if name="object_type" eq="page">
<$MTApp:PageActions from="edit_page"$>
<mt:else>
<$MTApp:PageActions from="edit_entry"$>
</mt:if>

<mt:include name="include/footer.tmpl" id="footer_include">
