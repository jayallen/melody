<?php
function smarty_function_MTArchiveLink($args, &$ctx) {
    // TODO: needs work
    $inside_cat = $ctx->stash('inside_mt_categories');
    if ($inside_cat) {
        require_once("function.MTCategoryArchiveLink.php");
        return smarty_function_MTCategoryArchiveLink($args, $ctx);
    }

    $blog = $ctx->stash('blog');
    $at = $ctx->stash('current_archive_type');
    $ts = $ctx->stash('current_timestamp');
    if ($at == 'Monthly') {
         $y = substr($ts, 0, 4); 
         $m = substr($ts, 4, 2); 
         $link = $blog['blog_archive_url'].$y.'/'.$m.'/index';
    } elseif ($at == 'Daily') {
         $y = substr($ts, 0, 4); 
         $m = substr($ts, 4, 2); 
         $d = substr($ts, 6, 2); 
         $link = $blog['blog_archive_url'].$y.'/'.$m.'/'.$d.'/index';
    } elseif ($at == 'Yearly') {
         $y = substr($ts, 0, 4); 
         $link = $blog['blog_archive_url'].$y.'/index';
    } elseif ($at == 'Individual') {
         require_once("function.MTEntryPermalink.php");
         return smarty_function_MTEntryPermalink($args, $ctx);
    }
    if ($blog['blog_file_extension']) {
        $link .= '.' . $blog['blog_file_extension'];
    }
    return $link;
}
/*
sub _hdlr_archive_link {
    ## Since this tag can be called from inside <MTCategories>,
    ## we need a way to map this tag to <$MTCategoryArchiveLink$>.
    return _hdlr_category_archive(@_) if $_[0]->{inside_mt_categories};
            
    my($ctx) = @_;
            
    my $blog = $ctx->stash('blog');
    my $entries = force($ctx->stash('entries'));
    if (!$entries && (my $e = $ctx->stash('entry'))) {
        push @$entries, $e;
    }           
                
    return $ctx->error(MT->translate(
        "You used an [_1] tag outside of the proper context.",
        '<$MTArchiveLink$>' ))
        unless ($ctx->{current_timestamp} ||
                ($entries && ref($entries)) eq 'ARRAY');
    # We assume there's an entry, but if there's no entry, 
    #   archive_file_for will use the current_timestamp instead
    my $entry = $entries->[0];
    my $at = $_[1]->{archive_type} || $ctx->{current_archive_type};
    my $arch = $blog->archive_url;
    $arch .= '/' unless $arch =~ m!/$!;
    $arch . archive_file_for($entry, $blog, $at, undef, undef,
                             $ctx->{current_timestamp}) 
}           
*/
?>
