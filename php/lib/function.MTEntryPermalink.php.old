<?php
function smarty_function_MTEntryPermalink($args, &$ctx) {
    return entry_permalink($ctx, $args);
}

function entry_permalink(&$ctx, $args) {
    require_once("MTUtil.php");
    $entry = $ctx->stash('entry');
    $blog = $ctx->stash('blog');
    $archive_path = $blog['blog_archive_url'];
    $link = $archive_path;
    if (substr($link, strlen($link) - 1, 1) != '/')
        $link .= '/';
    $entry_date = $entry['entry_created_on'];
    #$title = dirify($entry['entry_title']);
    #$title or $title = $entry['entry_id'];
    $title = $entry['entry_basename'];
    ##$link .= substr($entry_date, 0, 4) . '/' . substr($entry_date, 4, 2) . '/' . substr($entry_date, 6, 2) . '/' . $title;
    $link .= substr($entry_date, 0, 4) . '/' . substr($entry_date, 4, 2) . '/' . $title;
    if ($blog['blog_file_extension']) {
        $link .= '.' . $blog['blog_file_extension'];
    }
    return $link;
} 
?>
